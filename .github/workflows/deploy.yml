name: Deploy Frontend to AWS

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

     - name: Install Dependencies
        run: |
          cd ./your-subfolder  # Change to the correct folder if your project is inside a subfolder
          npm install

      - name: Build the Project
        run: npm run build

      - name: Deploy to AWS Server
        env:
          AWS_HOST: ${{ secrets.AWS_HOST }}
          AWS_SSH_KEY: ${{ secrets.AWS_SSH_KEY }}
        run: |
          echo "$AWS_SSH_KEY" > deploy_key.pem
          chmod 600 deploy_key.pem
          scp -o StrictHostKeyChecking=no -i deploy_key.pem -r dist/* ubuntu@$AWS_HOST:/home/ubuntu/wow-app/frontend/
          ssh -o StrictHostKeyChecking=no -i deploy_key.pem ubuntu@$AWS_HOST "sudo systemctl restart nginx"
